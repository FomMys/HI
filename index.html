<!DOCTYPE html>
<html>
<head>
<title>Pixel FPS Battle</title>
<style>
body {
    margin: 0;
    overflow: hidden;
    background: black;
    color: white;
    font-family: Arial, sans-serif;
}
#ui {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 10;
}
#health-bar, #shield-bar {
    height: 15px;
    width: 200px;
    margin-bottom: 5px;
}
#health-bar { background: red; }
#shield-bar { background: blue; }
#ammo { margin-top: 5px; }
#score {
    position: fixed;
    top: 10px;
    right: 10px;
    font-size: 24px;
}
canvas { display: block; }
</style>
</head>
<body>

<div id="ui">
    <div id="health-bar"></div>
    <div id="shield-bar"></div>
    <div id="ammo">30/∞</div>
</div>
<div id="score">0</div>

<canvas id="game-canvas"></canvas>

<script>
/* ================= CANVAS ================= */
const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');

const SCALE = 4;
const renderCanvas = document.createElement('canvas');
const rctx = renderCanvas.getContext('2d');

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    renderCanvas.width = canvas.width / SCALE;
    renderCanvas.height = canvas.height / SCALE;
    ctx.imageSmoothingEnabled = false;
    rctx.imageSmoothingEnabled = false;
}
resize();
window.addEventListener('resize', resize);

/* ================= PLAYER / CAMERA ================= */
const player = {
    health: 100,
    shield: 100,
    ammo: 30,
    recoil: 0
};

const camera = {
    x: 0,
    y: 0,
    angle: 0,
    sway: 0
};

/* ================= GAME ================= */
const game = {
    score: 0,
    bots: [],
    buildings: [],
    bullets: [],
    enemyBullets: [],
    lastShot: 0
};

/* ================= INPUT ================= */
const keys = { w:0,a:0,s:0,d:0,shift:0 };

window.addEventListener('keydown', e => {
    if (e.key.toLowerCase() in keys) keys[e.key.toLowerCase()] = 1;
    if (e.key === 'Shift') keys.shift = 1;
});
window.addEventListener('keyup', e => {
    if (e.key.toLowerCase() in keys) keys[e.key.toLowerCase()] = 0;
    if (e.key === 'Shift') keys.shift = 0;
});

canvas.addEventListener('click', () => canvas.requestPointerLock());

document.addEventListener('mousemove', e => {
    if (document.pointerLockElement === canvas) {
        camera.angle += e.movementX * 0.002;
        camera.sway = e.movementX * 0.002;
    }
});

canvas.addEventListener('mousedown', shoot);

/* ================= HELPERS ================= */
function worldToScreen(x,y) {
    return {
        x: x - camera.x + renderCanvas.width/2,
        y: y - camera.y + renderCanvas.height/2
    };
}

function rectCollide(ax,ay,aw,ah,bx,by,bw,bh) {
    return ax < bx+bw && ax+aw > bx && ay < by+bh && ay+ah > by;
}

/* ================= WALL COLLISION ================= */
function collideWalls(nx, ny) {
    for (const b of game.buildings) {
        if (rectCollide(nx-5,ny-5,10,10,b.x,b.y,b.w,b.h)) {
            return true;
        }
    }
    return false;
}

/* ================= SHOOT ================= */
function shoot() {
    const now = Date.now();
    if (now - game.lastShot < 200 || player.ammo <= 0) return;

    player.ammo--;
    game.lastShot = now;
    player.recoil = 6;

    game.bullets.push({
        x: camera.x,
        y: camera.y,
        dx: Math.cos(camera.angle)*18,
        dy: Math.sin(camera.angle)*18,
        life: 60
    });
}

/* ================= SPAWN ================= */
function spawnBot() {
    game.bots.push({
        x: camera.x + (Math.random()*600 - 300),
        y: camera.y + (Math.random()*600 - 300),
        speed: 1.2,
        health: 100,
        shootTimer: 0
    });
}

function spawnBuilding() {
    game.buildings.push({
        x: Math.random()*2000 - 1000,
        y: Math.random()*2000 - 1000,
        w: 100,
        h: 100
    });
}

/* ================= UI ================= */
function updateUI() {
    document.getElementById('health-bar').style.width = player.health*2+'px';
    document.getElementById('shield-bar').style.width = player.shield*2+'px';
    document.getElementById('ammo').textContent = player.ammo+'/∞';
    document.getElementById('score').textContent = game.score;
}

/* ================= LOOP ================= */
function gameLoop() {
    rctx.clearRect(0,0,renderCanvas.width,renderCanvas.height);

    /* Movement */
    let speed = keys.shift ? 5 : 3;
    let nx = camera.x;
    let ny = camera.y;

    if (keys.w) { nx += Math.cos(camera.angle)*speed; ny += Math.sin(camera.angle)*speed; }
    if (keys.s) { nx -= Math.cos(camera.angle)*speed; ny -= Math.sin(camera.angle)*speed; }
    if (keys.a) { nx += Math.cos(camera.angle-Math.PI/2)*speed; ny += Math.sin(camera.angle-Math.PI/2)*speed; }
    if (keys.d) { nx += Math.cos(camera.angle+Math.PI/2)*speed; ny += Math.sin(camera.angle+Math.PI/2)*speed; }

    if (!collideWalls(nx,ny)) {
        camera.x = nx;
        camera.y = ny;
    }

    /* Buildings */
    rctx.fillStyle = '#654321';
    game.buildings.forEach(b => {
        const p = worldToScreen(b.x,b.y);
        rctx.fillRect(p.x,p.y,b.w/SCALE,b.h/SCALE);
    });

    /* Bots AI */
    game.bots.forEach(bot => {
        const dist = Math.hypot(camera.x-bot.x,camera.y-bot.y);
        const angle = Math.atan2(camera.y-bot.y,camera.x-bot.x);

        if (dist > 120) {
            const bx = bot.x + Math.cos(angle)*bot.speed;
            const by = bot.y + Math.sin(angle)*bot.speed;
            if (!collideWalls(bx,by)) {
                bot.x = bx;
                bot.y = by;
            }
        } else {
            bot.shootTimer++;
            if (bot.shootTimer > 40) {
                bot.shootTimer = 0;
                game.enemyBullets.push({
                    x: bot.x,
                    y: bot.y,
                    dx: Math.cos(angle)*10,
                    dy: Math.sin(angle)*10,
                    life: 60
                });
            }
        }

        const p = worldToScreen(bot.x,bot.y);
        rctx.fillStyle = 'red';
        rctx.fillRect(p.x-4,p.y-8,8,16);
    });

    /* Player bullets */
    game.bullets.forEach((b,i) => {
        b.x+=b.dx; b.y+=b.dy; b.life--;
        const p = worldToScreen(b.x,b.y);
        rctx.fillStyle='yellow';
        rctx.fillRect(p.x,p.y,2,2);

        game.bots.forEach((bot,bi)=>{
            if (Math.hypot(bot.x-b.x,bot.y-b.y)<10) {
                bot.health-=50;
                b.life=0;
                if (bot.health<=0) {
                    game.bots.splice(bi,1);
                    game.score+=100;
                }
            }
        });

        if (b.life<=0) game.bullets.splice(i,1);
    });

    /* Enemy bullets */
    game.enemyBullets.forEach((b,i)=>{
        b.x+=b.dx; b.y+=b.dy; b.life--;
        const p = worldToScreen(b.x,b.y);
        rctx.fillStyle='orange';
        rctx.fillRect(p.x,p.y,2,2);

        if (Math.hypot(camera.x-b.x,camera.y-b.y)<10) {
            player.health-=5;
            b.life=0;
        }

        if (b.life<=0) game.enemyBullets.splice(i,1);
    });

    /* Weapon */
    player.recoil*=0.8;
    rctx.fillStyle='#333';
    rctx.fillRect(
        renderCanvas.width/2-20+camera.sway*5,
        renderCanvas.height-20+player.recoil,
        40,12
    );

    /* Crosshair */
    rctx.strokeStyle='white';
    rctx.beginPath();
    rctx.moveTo(renderCanvas.width/2-4,renderCanvas.height/2);
    rctx.lineTo(renderCanvas.width/2+4,renderCanvas.height/2);
    rctx.moveTo(renderCanvas.width/2,renderCanvas.height/2-4);
    rctx.lineTo(renderCanvas.width/2,renderCanvas.height/2+4);
    rctx.stroke();

    ctx.drawImage(renderCanvas,0,0,canvas.width,canvas.height);

    updateUI();
    if (Math.random()<0.01 && game.bots.length<8) spawnBot();

    requestAnimationFrame(gameLoop);
}

/* ================= INIT ================= */
for (let i=0;i<12;i++) spawnBuilding();
for (let i=0;i<4;i++) spawnBot();
updateUI();
gameLoop();
</script>
</body>
</html>
